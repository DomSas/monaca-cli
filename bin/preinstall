#!/usr/bin/env node

var exec = require("child_process").exec,
    hasError = false;


// check xcode
var checkComponent = function(component, callback){
    console.log('\nChecking for ' + component.name + ' ...');

    exec(component.cmd, function(err, stdout, stderr) {
        if (err) {
            hasError = true;
            process.stderr.write('NG: Ensure you have installed ' + component.name + '.\n');
        } else {
            console.log('OK');
        }

        if (callback) callback();
    });
};

var components = [
    {
        name: 'XCode',
        cmd: "pkgutil --pkgs='com\.apple\.pkg\.Xcode.*'"
    },
    {
        name: 'XCode Command Line Tools',
        cmd: 'xcode-select -p'
    }
];

(function loop(){
    if (!components.length) {
        if (hasError) {
            process.stderr.write('\nWraning: Several dependent components is not installed. Please install that.\n');
        } else {
            console.log('\nSuccess: Confirmed that the dependent components are installed.');
        }

        return;
    }

    checkComponent(components.shift(), loop);
})()
