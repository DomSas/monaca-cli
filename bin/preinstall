#!/usr/bin/env node

var exec = require("child_process").exec;

// check xcode
var checkComponent = function(component, success, failure){
    console.log('\nChecking for ' + component.name + ' ...');

    var cp = exec(component.cmd);

    cp.stdout.setEncoding('utf8');
    cp.on('error', function(error){
        process.stderr.write('NG: Ensure you have installed ' + component.name + '.\n');
        if (failure) failure();
    });
    cp.on('exit', function(code) {
        console.log('OK');
        if (success) success();
    });
};

checkComponent({
    name: 'XCode',
    cmd: "pkgutil --pkgs='com\.apple\.pkg\.Xcode.*'"
}, function(){
    checkComponent({
        name: 'XCode Command Line Tools',
        cmd: 'xcode-select -p'
    }, function(){
        console.log('\nSuccess: Confirmed that the dependent components are installed.');
    })   
});
